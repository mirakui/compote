# vim:ft=ruby

table_opts = { force: :cascade }

create_table :sources, table_opts do |t|
  t.integer   :isbn, limit: 8 # bigint
  t.text      :body, null: false, limit: 16777215 # mediumtext
  t.timestamps
end
add_index :sources, :isbn

create_table :books, table_opts do |t|
  t.string     :asin, null: false, limit: 32
  t.string     :raw_title
  t.string     :title
  t.belongs_to :serieses, index: true
  t.integer    :series_order
  t.string     :series_order_label
  t.belongs_to :publisher, index: true
  t.boolean    :is_adult, default: false
  t.boolean    :is_ebook, default: false
  t.belongs_to :source, index: true
  t.date       :published_on
  t.date       :released_on
  t.timestamps
end
add_index :books, [:asin], unique: true
add_index :books, [:published_on]
add_index :books, [:released_on]

create_table :authors, table_opts do |t|
  t.string    :name
  t.timestamps
end

create_table :authors_books, table_opts do |t|
  t.belongs_to :book
  t.belongs_to :author
end
add_index :authors_books, [:book_id, :author_id], unique: true

create_table :serieses, table_opts do |t|
  t.string     :title
  t.timestamps
end

create_table :publishers, table_opts do |t|
  t.string     :name
  t.timestamps
end
